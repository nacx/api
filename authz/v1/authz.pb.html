---
title: tetrate.api.authz.v1
layout: protoc-gen-docs
generator: protoc-gen-docs
number_of_entries: 7
---
<h2 id="Binding">Binding</h2>
<section>
<p>Binding</p>

<p>Bindings define the subjects that can access the resource a policy is attached to,
and the conditions that need to be met for that access to be granted.
A policy can have multiple bindings to configure different access controls for specific
subjects.</p>

<table class="message-fields">
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr id="Binding-display_name">
<td><code>displayName</code></td>
<td><code>string</code></td>
<td>
<p>A friendly name to identify the binding.</p>

</td>
</tr>
<tr id="Binding-description">
<td><code>description</code></td>
<td><code>string</code></td>
<td>
<p>A detailed description of the purpose of the binding.</p>

</td>
</tr>
<tr id="Binding-allow_http" class="oneof oneof-start">
<td><code>allowHttp</code></td>
<td><code><a href="#Binding-HTTP_Rules">Binding.HTTP_Rules (oneof)</a></code></td>
<td>
<p>HTTP rules to be enforced by this binding in order to grant access to the target resource.</p>

</td>
</tr>
<tr id="Binding-from">
<td><code>from</code></td>
<td><code><a href="#Subject">Subject[]</a></code></td>
<td>
<p>Subjects configure the actors (end users, other services)  that are allowed to access the
target resource.</p>

</td>
</tr>
</tbody>
</table>
</section>
<h2 id="Binding-HTTP_Rules">Binding.HTTP_Rules</h2>
<section>
<table class="message-fields">
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr id="Binding-HTTP_Rules-to">
<td><code>to</code></td>
<td><code><a href="#Binding-HTTP_Rules-Http">Binding.HTTP_Rules.Http[]</a></code></td>
<td>
<p>A set of HTTP rules that need to be satisfied by the HTTP requests to get access to the
target resource.</p>

</td>
</tr>
</tbody>
</table>
</section>
<h2 id="Binding-HTTP_Rules-Http">Binding.HTTP_Rules.Http</h2>
<section>
<p>HTTP Rule</p>

<p>HTTP rules configure specific matching conditions on the HTTP requests made to the
target resource. Access to the resource will only be allowed if all the conditions
expressed in all the HTTP rules are met.</p>

<p>All fields are optional, and only the relevant ones have to be configured.</p>

<table class="message-fields">
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr id="Binding-HTTP_Rules-Http-hosts">
<td><code>hosts</code></td>
<td><code>string[]</code></td>
<td>
<p>When applying policies to applications, the hosts field can be used to restrict
the hosts each rule applies to. Applications can be exposed on multiple
hostnames in the corresponding load balancers, and rules may only target some of them.
E.g. [&ldquo;bookinfo.com&rdquo;].</p>

</td>
</tr>
<tr id="Binding-HTTP_Rules-Http-paths">
<td><code>paths</code></td>
<td><code>string[]</code></td>
<td>
<p>The request path where the request is made against. E.g. [&ldquo;/accounts&rdquo;].</p>

</td>
</tr>
<tr id="Binding-HTTP_Rules-Http-methods">
<td><code>methods</code></td>
<td><code>string[]</code></td>
<td>
<p>The HTTP methods that are allowed by this rule. E.g. [&ldquo;GET&rdquo;, &ldquo;HEAD&rdquo;].</p>

</td>
</tr>
<tr id="Binding-HTTP_Rules-Http-request_headers">
<td><code>requestHeaders</code></td>
<td><code>map&lt;string,&nbsp;string&gt;</code></td>
<td>
<p>A set of request headers that are required in this rule.
Note that this set of headers is different than the headers that can be configured in
the subject, as these headers will only apply to the configured paths and other fields
in this HTTP rule.
E.g. &ldquo;X-App-Id&rdquo;: &ldquo;bookinfo&rdquo;.</p>

</td>
</tr>
<tr id="Binding-HTTP_Rules-Http-ports">
<td><code>ports</code></td>
<td><code>int32[]</code></td>
<td>
<p>The ports in the target service this rule will apply for. E.g. [&ldquo;80&rdquo;, &ldquo;443&rdquo;].</p>

</td>
</tr>
</tbody>
</table>
</section>
<h2 id="Policy">Policy</h2>
<section>
<p>Runtime Authorization Policy</p>

<p>Runtime authorization policies are attached to specific resources and define which subjects,
and under which conditions, are allowed to access them.
Different subjects can be configured to access the target resource with different conditions
by setting multiple bindings in the same policy.</p>

<p>The default authorization policy allows access between services within an application, and denies
cross-application traffic. Traffic between applications must be explicitly enabled by applying
the corresponding access policy in the target application.</p>

<p>THe following examples show some common policies:</p>

<pre><code># Default deny policy for applications. The absence of bindings means that there is no
# access allowed from outside the application.
policy:

# Allow access from the 'bookinfo' application. Requests from the client application
# present a JWT token for the 'bookinfo' application.
policy:
  bindings:
  - from:
    - jwt:
        principal: bookinfo
        audience: tsb
        claims:
          group: applications

# Allow access from the 'bookinfo' application, but only to the '/v1/*'
# HTTP paths, and only for GET and HEAD requests, on the 'bookinfo.com' host.
policy:
  bindings:
  - from:
    - jwt:
        principal: bookinfo
        audience: tsb
        claims:
          group: applications
    allow_http:
      to:
      - paths:
        - /v1/*
        hosts:
        - bookinfo.com
        methods:
        - GET
        - HEAD

# Allow access from the 'bookinfo' application, but only to the '/v1/*'
# HTTP paths, and only for GET and HEAD requests, on the 'bookinfo.com' host.
# In this example the client application is identified by checking the value of
# the 'X-App-Id' request header.
policy:
  bindings:
  - from:
    - request_headers:
        X-App-Id: bookinfo
    allow_http:
      to:
      - paths:
        - /v1/*
        hosts:
        - bookinfo.com
        methods:
        - GET
        - HEAD

# When applied to a service, allows traffic only from the configured identities.
policy:
  bindings:
  - from:
    - cluster_local_service_account: default/bookinfo-sa
    - subject_alt_name: spiffe://cluster.local/ns/default/sa/bookinfo-sa
</code></pre>

<table class="message-fields">
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr id="Policy-bindings">
<td><code>bindings</code></td>
<td><code><a href="#Binding">Binding[]</a></code></td>
<td>
<p>List of bindings that configure access to the target resource.</p>

</td>
</tr>
<tr id="Policy-etag">
<td><code>etag</code></td>
<td><code>string</code></td>
<td>
<p>Etag to guard concurrent modifications to the policy.</p>

</td>
</tr>
</tbody>
</table>
</section>
<h2 id="Subject">Subject</h2>
<section>
<p>Subject</p>

<p>A subject designates an actor (user, service, etc) that attempts to access a target resource.
Subjects can be modeled with JWT tokens, service accounts, and decorated with attributes such as
HTTP request headers, JWT token claims, etc.
The fields that define a subject will be matched to incoming requests, to fully qualify where the
request comes from, and to decide if the given request is allowed or not for the target resource.
All the fields in a subject are evaluated as AND expressions.</p>

<table class="message-fields">
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr id="Subject-jwt">
<td><code>jwt</code></td>
<td><code><a href="#Subject-JWT">Subject.JWT</a></code></td>
<td>
<p>JWT configuration to identity the subject.</p>

</td>
</tr>
<tr id="Subject-request_headers">
<td><code>requestHeaders</code></td>
<td><code>map&lt;string,&nbsp;string&gt;</code></td>
<td>
<p>Request headers used to qualify a subject.
E.g. &ldquo;User-Agent&rdquo;: &ldquo;Mozilla/*&rdquo;.</p>

</td>
</tr>
<tr id="Subject-cluster_local_service_account" class="oneof oneof-start">
<td><code>clusterLocalServiceAccount</code></td>
<td><code>string (oneof)</code></td>
<td>
<p>A cluster service account in &lsquo;namespace/service-account-name&rsquo; format.</p>

</td>
</tr>
<tr id="Subject-subject_alt_name" class="oneof">
<td><code>subjectAltName</code></td>
<td><code>string (oneof)</code></td>
<td>
<p>A SPIFFe URL or any Subject Alternative Name (SAN).
In future, we can add other x509 fields here.</p>

</td>
</tr>
</tbody>
</table>
</section>
<h2 id="Subject-JWT">Subject.JWT</h2>
<section>
<p>JWT based subject</p>

<p>JWT based subjects qualify a subject by matching against a JWT token present in the request.
By default the token is expected to be present in the &lsquo;Authorization&rsquo; HTTP header, with the
&lsquo;Bearer&rdquo; prefix.</p>

<table class="message-fields">
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr id="Subject-JWT-principal">
<td><code>principal</code></td>
<td><code>string</code></td>
<td>
<p>The principal qualifies the authority under which the request is made.
In Istio environments this is the value of the Issuer claim (iss) concatenated with the
value of teh Subject (sub) claim, separated with a &lsquo;/&rsquo;.</p>

</td>
</tr>
<tr id="Subject-JWT-audience">
<td><code>audience</code></td>
<td><code>string</code></td>
<td>
<p>Audience intended for the token. This is the value of the &lsquo;aud&rsquo; claim.</p>

</td>
</tr>
<tr id="Subject-JWT-presenter">
<td><code>presenter</code></td>
<td><code>string</code></td>
<td>
<p>The authorized presenter of the token. This takes the value of the &lsquo;azp&rsquo; claim.</p>

</td>
</tr>
<tr id="Subject-JWT-claims">
<td><code>claims</code></td>
<td><code>map&lt;string,&nbsp;string&gt;</code></td>
<td>
<p>A set of arbitrary claims that are required to qualify the subject.
E.g. &ldquo;iss&rdquo;: &ldquo;*@foo.com&rdquo;.</p>

</td>
</tr>
<tr id="Subject-JWT-validation">
<td><code>validation</code></td>
<td><code><a href="#Subject-JWT-Validation">Subject.JWT.Validation</a></code></td>
<td>
<p>Configuration to validate the JWT tokens for this subject.</p>

</td>
</tr>
</tbody>
</table>
</section>
<h2 id="Subject-JWT-Validation">Subject.JWT.Validation</h2>
<section>
<table class="message-fields">
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr id="Subject-JWT-Validation-issuer">
<td><code>issuer</code></td>
<td><code>string</code></td>
<td>
<p>The issuer that is expected for this JWT subject.</p>

</td>
</tr>
<tr id="Subject-JWT-Validation-audiences">
<td><code>audiences</code></td>
<td><code>string[]</code></td>
<td>
<p>Optional audiences to validate the JWT token against.</p>

</td>
</tr>
<tr id="Subject-JWT-Validation-jwksUri" class="oneof oneof-start">
<td><code>jwksUri</code></td>
<td><code>string (oneof)</code></td>
<td>
<p>The URI of a JWKS file that can be used to validate the JWT token.</p>

</td>
</tr>
<tr id="Subject-JWT-Validation-jwks" class="oneof">
<td><code>jwks</code></td>
<td><code>string (oneof)</code></td>
<td>
<p>The literal JWKS to be used to validate teh token. The format of this string
is described in https://tools.ietf.org/html/rfc7517.</p>

</td>
</tr>
</tbody>
</table>
</section>
