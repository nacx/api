---
title: Clusters
description: Configuration for onboarding clusters.
location: https://tetrate.io/docs/reference/config/v1/cluster.html
layout: protoc-gen-docs
generator: protoc-gen-docs
number_of_entries: 13
---
<p>Each Kubernetes cluster managed by Service Bridge should be
onboarded first before configurations can be applied to the
services in the cluster. Onboarding a cluster is a two step
process. First, create a cluster object under the appropriate
tenant. Once a cluster object is created, its status field should
provide the set of join tokens that will be used by the Service
Bridge agent on the cluster to talk to Service Bridge management
plane. The second step is to deploy the Service Bridge agent on the
cluster with the join tokens and deploy Istio on the cluster. The
following example creates a cluster named c1 under the tenant
mycompany.</p>

<pre><code class="language-yaml">apiVersion: api.tsb.tetrate.io/v1
kind: Cluster
metadata:
  name: c1
  tenant: mycompany
spec:
  tokenTtl: &quot;1hr&quot;
</code></pre>

<p>Note that configuration profiles such as traffic, security and
gateway groups will flow to the Bridge agents in the cluster as
long their requested cluster exists in the Service Bridge
hierarchy.</p>

<h2 id="Services">Services</h2>
<h3 id="TSB">TSB</h3>
<section>
<pre id="TSB-Apply"><code class="language-proto">rpc Apply(Object) returns (Object)
</code></pre>
<p>used by bridge apply -f, the UI
No REST API. UI and cli will use grpc directly.</p>

<pre id="TSB-Get"><code class="language-proto">rpc Get(Object) returns (Object)
</code></pre>
<p>for both list and get</p>

<pre id="TSB-Delete"><code class="language-proto">rpc Delete(Object) returns (Object)
</code></pre>
</section>
<h2 id="Types">Types</h2>
<h3 id="Object">Object</h3>
<section>
<p>Format for all API objects in TSB</p>

<table class="message-fields">
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
<th>Required</th>
</tr>
</thead>
<tbody>
<tr id="Object-api_version">
<td><code>apiVersion</code></td>
<td><code>string</code></td>
<td>
<p>api.tsb.tetrate.io/v1, traffic.tsb.tetrate.io/v1,
security.tsb.tetrate.io/v1, gateway.tsb.tetrate.io/v1,
networking.istio.io/v1beta1, security.istio.io/v1beta1, etc.</p>

</td>
<td>
No
</td>
</tr>
<tr id="Object-kind">
<td><code>kind</code></td>
<td><code>string</code></td>
<td>
<p>Workspace, Cluster, Tenant, Team, User, WorkspaceSetting, Group
(under traffic.tsb.tetrate.io and security.tsb.tetrate.io),
TrafficSetting, SecuritySetting, etc.</p>

</td>
<td>
No
</td>
</tr>
<tr id="Object-metadata">
<td><code>metadata</code></td>
<td><code><a href="#ObjectMeta">ObjectMeta</a></code></td>
<td>
</td>
<td>
No
</td>
</tr>
<tr id="Object-spec">
<td><code>spec</code></td>
<td><code>bytes</code></td>
<td>
</td>
<td>
No
</td>
</tr>
<tr id="Object-status">
<td><code>status</code></td>
<td><code>bytes</code></td>
<td>
<p>Contains errors, tokens (in case of cluster onboarding, and other information).</p>

</td>
<td>
No
</td>
</tr>
</tbody>
</table>
</section>
<h3 id="ObjectMeta">ObjectMeta</h3>
<section>
<table class="message-fields">
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
<th>Required</th>
</tr>
</thead>
<tbody>
<tr id="ObjectMeta-name">
<td><code>name</code></td>
<td><code>string</code></td>
<td>
</td>
<td>
No
</td>
</tr>
<tr id="ObjectMeta-namespace">
<td><code>namespace</code></td>
<td><code>string</code></td>
<td>
<p>Applicable for Istio objects</p>

</td>
<td>
No
</td>
</tr>
<tr id="ObjectMeta-tenant">
<td><code>tenant</code></td>
<td><code>string</code></td>
<td>
</td>
<td>
No
</td>
</tr>
<tr id="ObjectMeta-workspace">
<td><code>workspace</code></td>
<td><code>string</code></td>
<td>
</td>
<td>
No
</td>
</tr>
<tr id="ObjectMeta-group">
<td><code>group</code></td>
<td><code>string</code></td>
<td>
</td>
<td>
No
</td>
</tr>
<tr id="ObjectMeta-resource_version">
<td><code>resourceVersion</code></td>
<td><code>string</code></td>
<td>
</td>
<td>
No
</td>
</tr>
<tr id="ObjectMeta-labels">
<td><code>labels</code></td>
<td><code>map&lt;string,&nbsp;string&gt;</code></td>
<td>
</td>
<td>
No
</td>
</tr>
<tr id="ObjectMeta-annotations">
<td><code>annotations</code></td>
<td><code>map&lt;string,&nbsp;string&gt;</code></td>
<td>
<p>Istio artifacts should contain 3 annotations
tsb.tetrate.io/tenant, tsb.tetrate.io/workspace,
tsb.tetrate.io/trafficGroup or tsb.tetrate.io/securityGroup or
tsb.tetrate.io/gatewayGroup</p>

</td>
<td>
No
</td>
</tr>
</tbody>
</table>
</section>
<h3 id="Cluster">Cluster</h3>
<section>
<p>A Kubernetes cluster managing both pods and VMs.</p>

<table class="message-fields">
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
<th>Required</th>
</tr>
</thead>
<tbody>
<tr id="Cluster-token_ttl">
<td><code>tokenTtl</code></td>
<td><code><a href="https://developers.google.com/protocol-buffers/docs/reference/google.protobuf#duration">Duration</a></code></td>
<td>
<p>Lifetime of the tokens. Defaults to 1hr.</p>

</td>
<td>
No
</td>
</tr>
<tr id="Cluster-namespaces">
<td><code>namespaces</code></td>
<td><code><a href="#Namespace">Namespace[]</a></code></td>
<td>
<p>Read-only data for informational purposes. Any user provided
value will be ignored. The data here may be stale depending on
the update frequency from the Bridge agents in the cluster.</p>

</td>
<td>
No
</td>
</tr>
</tbody>
</table>
</section>
<h3 id="ClusterStatus">ClusterStatus</h3>
<section>
<p>The status message for a cluster resource contains the set of join
tokens that should be used by Service Bridge&rsquo;s agents on the
cluster.</p>

<table class="message-fields">
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
<th>Required</th>
</tr>
</thead>
<tbody>
<tr id="ClusterStatus-tokens">
<td><code>tokens</code></td>
<td><code>map&lt;string,&nbsp;string&gt;</code></td>
<td>
<p>Tokens for various agents.</p>

</td>
<td>
No
</td>
</tr>
</tbody>
</table>
</section>
<h3 id="Namespace">Namespace</h3>
<section>
<p>A Kubernetes namespace. These are automatically discovered by the
Service Bridge agents in the cluster.</p>

<table class="message-fields">
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
<th>Required</th>
</tr>
</thead>
<tbody>
<tr id="Namespace-name">
<td><code>name</code></td>
<td><code>string</code></td>
<td>
</td>
<td>
No
</td>
</tr>
<tr id="Namespace-services">
<td><code>services</code></td>
<td><code><a href="#Service">Service[]</a></code></td>
<td>
</td>
<td>
No
</td>
</tr>
</tbody>
</table>
</section>
<h3 id="Service">Service</h3>
<section>
<p>A Kubernetes or a VM service. These are automatically discovered by
the Service Bridge agents in the cluster.</p>

<table class="message-fields">
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
<th>Required</th>
</tr>
</thead>
<tbody>
<tr id="Service-hostname">
<td><code>hostname</code></td>
<td><code>string</code></td>
<td>
</td>
<td>
No
</td>
</tr>
<tr id="Service-ports">
<td><code>ports</code></td>
<td><code><a href="#Service-Port">Port[]</a></code></td>
<td>
<p>The set of ports on which this service is exposed.</p>

</td>
<td>
No
</td>
</tr>
<tr id="Service-kubernetes_service_ip">
<td><code>kubernetesServiceIp</code></td>
<td><code>string</code></td>
<td>
<p>For services running on Kubernetes, the cluster IP of the service in the cluster.</p>

</td>
<td>
No
</td>
</tr>
<tr id="Service-kubernetes_external_addresses">
<td><code>kubernetesExternalAddresses</code></td>
<td><code>string[]</code></td>
<td>
<p>For kubernetes services of type load balancer, this field contains the list of lb hostnames or
IPs assigned to the service. For services of type nodePort, this field contains the IP
addresses of the nodes in the cluster.</p>

</td>
<td>
No
</td>
</tr>
</tbody>
</table>
</section>
<h3 id="Service-Port">Service.Port</h3>
<section>
<table class="message-fields">
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
<th>Required</th>
</tr>
</thead>
<tbody>
<tr id="Service-Port-number">
<td><code>number</code></td>
<td><code>uint32</code></td>
<td>
<p>A valid non-negative integer port number.</p>

</td>
<td>
No
</td>
</tr>
<tr id="Service-Port-name">
<td><code>name</code></td>
<td><code>string</code></td>
<td>
<p>Name assigned to the port.</p>

</td>
<td>
No
</td>
</tr>
<tr id="Service-Port-kubernetes_node_port">
<td><code>kubernetesNodePort</code></td>
<td><code>uint32</code></td>
<td>
<p>Indicates the node port attached to a physical deployment on a kubernetes cluster.</p>

</td>
<td>
No
</td>
</tr>
</tbody>
</table>
</section>
<h3 id="Workspace">Workspace</h3>
<section>
<p>A Kubernetes cluster managing both pods and VMs.</p>

<table class="message-fields">
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
<th>Required</th>
</tr>
</thead>
<tbody>
<tr id="Workspace-namespace_selectors">
<td><code>namespaceSelectors</code></td>
<td><code><a href="https://tetrate.io/docs/reference/config/types/v1/types.html#NamespaceSelector">NamespaceSelector[]</a></code></td>
<td>
<p>Set of namespaces owned exclusively by this workspace. A
workspace can own all namespaces of a cluster or a set of
namespaces across any cluster or a set of namespaces in a
specific cluster.</p>

</td>
<td>
Yes
</td>
</tr>
<tr id="Workspace-privileged">
<td><code>privileged</code></td>
<td><code><a href="https://developers.google.com/protocol-buffers/docs/reference/google.protobuf#boolvalue">BoolValue</a></code></td>
<td>
<p>If set to true, allows Gateways in the workspace to route to
services in other workspaces. Set this to true for workspaces
owning cluster-wide gateways shared by multiple teams.</p>

</td>
<td>
No
</td>
</tr>
</tbody>
</table>
</section>
<h3 id="tetrateio-api-tsb-types-v1-NamespaceSelector">tetrateio.api.tsb.types.v1.NamespaceSelector</h3>
<section>
<p><code>NamespaceSelector</code> selects a set of namespaces across one or more
clusters in a tenant. Namespace selectors can be used at Workspace
level to carve out a chunk of resources under a tenant into an
isolated configuration domain. They can be used in a Traffic,
Security, or a Gateway group to further scope the set of namespaces
that will belong to a specific configuration group.</p>

<table class="message-fields">
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
<th>Required</th>
</tr>
</thead>
<tbody>
<tr id="tetrateio-api-tsb-types-v1-NamespaceSelector-name">
<td><code>name</code></td>
<td><code>string</code></td>
<td>
<ul>
<li><p><code>*/ns1</code> implies <code>ns1</code> namespace in any cluster under the tenant.</p></li>

<li><p><code>c1/ns1</code> implies <code>ns1</code> namespace from <code>c1</code> cluster.</p></li>

<li><p><code>c1/*</code> implies all namespaces in <code>c1</code> cluster.</p></li>
</ul>

</td>
<td>
Yes
</td>
</tr>
</tbody>
</table>
</section>
<h3 id="Team">Team</h3>
<section>
<p><code>Team</code> is a named collection of users under a tenant.</p>

<table class="message-fields">
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
<th>Required</th>
</tr>
</thead>
<tbody>
<tr id="Team-users">
<td><code>users</code></td>
<td><code>string[]</code></td>
<td>
<p>List of users under the team. These users should be present in
the LDAP server.</p>

</td>
<td>
No
</td>
</tr>
<tr id="Team-service_accounts">
<td><code>serviceAccounts</code></td>
<td><code>string[]</code></td>
<td>
<p>List of automation processes whose user names are local to service bridge.</p>

</td>
<td>
No
</td>
</tr>
<tr id="Team-teams">
<td><code>teams</code></td>
<td><code><a href="https://tetrate.io/docs/reference/config/v1/team.html#Team">Team[]</a></code></td>
<td>
<p>Teams can compose of other teams.</p>

</td>
<td>
No
</td>
</tr>
</tbody>
</table>
</section>
<h3 id="Tenant">Tenant</h3>
<section>
<p><code>Tenant</code> is the root of the Service Bridge object hierarchy.</p>

</section>
<h3 id="WorkspaceSetting">WorkspaceSetting</h3>
<section>
<p>Default security and traffic settings for all sidecars in the workspace.</p>

<table class="message-fields">
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
<th>Required</th>
</tr>
</thead>
<tbody>
<tr id="WorkspaceSetting-default_security_setting">
<td><code>defaultSecuritySetting</code></td>
<td><code><a href="https://tetrate.io/docs/reference/config/security/v1/security-setting.html#SecuritySetting">SecuritySetting</a></code></td>
<td>
<p>Security settings for all sidecars in this workspace. Sidecars
without a specific security group will inherit these settings. If
omitted, the following semantics apply:</p>

<ol>
<li><p>Sidecars will accept connections from clients using
Istio Mutual TLS as well as legacy clients using plaintext
(i.e. any traffic not using Istio Mutual TLS authentication)</p></li>

<li><p>No authorization will be performed.</p></li>
</ol>

</td>
<td>
No
</td>
</tr>
<tr id="WorkspaceSetting-default_traffic_setting">
<td><code>defaultTrafficSetting</code></td>
<td><code><a href="https://tetrate.io/docs/reference/config/traffic/v1/traffic-setting.html#TrafficSetting">TrafficSetting</a></code></td>
<td>
<p>Traffic settings for all sidecars in this workspace. Sidecars
without a specific traffic group will inherit these settings. If
omitted, the following semantics apply:</p>

<ol>
<li><p>Sidecars will be able to reach only services within their
namespace in the cluster, i.e. reachability mode defaults to
<code>NAMESPACE</code>.</p></li>

<li><p>Traffic to unknown destinations will be directly routed from
the sidecar to the destination.</p></li>
</ol>

</td>
<td>
No
</td>
</tr>
</tbody>
</table>
</section>
