---
title: Traffic Group
description: Configurations to group a set of sidecars in a workspace for traffic management.
location: https://tetrate.io/docs/reference/config/traffic/v1/group.html
layout: protoc-gen-docs
generator: protoc-gen-docs
number_of_entries: 12
---
<p>Traffic Groups allow grouping the sidecars in a set of namespaces
owned by its parent workspace. Networking and routing related
configurations can then be applied on the group to control the
behavior of these sidecars. The group can be in one of two modes:
<code>TETRATE</code> and <code>ISTIO</code>. <code>TETRATE</code> mode is a minimalistic mode that
allows users to quickly configure the most commonly used features
in the service mesh using Tetrate specific APIs, while the <code>ISTIO</code>
mode provides more flexibility for power users by allowing them to
configure the sidecar behavior using a restricted subset of Istio
Networking APIs.</p>

<p>The following example creates a traffic group for the sidecars in
<code>ns1</code>, <code>ns2</code> and <code>ns3</code> namespaces owned by its parent workspace
<code>w1</code> under tenant <code>mycompany</code> and sets up a <code>TrafficSetting</code>
defining the resilience properties for sidecars in these
namespaces.</p>

<pre><code class="language-yaml">apiVersion: traffic.tsb.tetrate.io/v1
kind: Group
metadata:
  name: t1
  workspace: w1
  tenant: mycompany
spec:
  namespaceSelectors:
  - name: */ns1
  - name: */ns2
  - name: */ns3
  configMode: TETRATE
</code></pre>

<p>And the associated traffic settings for the sidecars in the group</p>

<pre><code class="language-yaml">apiVersion: traffic.tsb.tetrate.io/v1
kind: TrafficSetting
metadata:
  name: defaults
  group: t1
  workspace: w1
  tenant: mycompany
spec:
  resilience:
    circuitBreakerSensitivity: MEDIUM
</code></pre>

<p>Under the hood, Service Bridge translates these minimalistic
settings into Istio APIs such as <code>Sidecar</code>, <code>DestinationRule</code>,
etc. for the namespaces managed by the traffic group. These APIs
are then pushed to the Istio control planes of clusters where the
workspace is applicable.</p>

<p>It is possible to create a traffic group for namespaces in a
specific cluster as long as the parent workspace owns those
namespaces in that cluster. For example,</p>

<pre><code class="language-yaml">apiVersion: traffic.tsb.tetrate.io/v1
kind: Group
metadata:
  name: t1
  workspace: w1
  tenant: mycompany
spec:
  namespaceSelectors:
  - name: c1/ns1 # pick ns1 namespace only from c1 cluster
  - name: */ns2
  - name: */ns3
  configMode: TETRATE
</code></pre>

<p>In the <code>ISTIO</code> mode, it is possible to directly attach Istio APIs
such as <code>VirtualService</code>, <code>DestinationRule</code>, and <code>Sidecar</code> to the
traffic group. These configurations will be validated for
correctness and conflict free operations and then pushed to the
appropriate Istio control planes.</p>

<p>The following example declares a <code>DestinationRule</code> with two
subsets, for the <code>ratings</code> service in the <code>ns1</code> namespace:</p>

<pre><code class="language-yaml">apiVersion: networking.istio.io/v1beta1
kind: DestinationRule
metadata:
  name: ratings-subsets
  namespace: ns1
  annotations:
    tsb.tetrate.io/tenant: mycompany
    tsb.tetrate.io/workspace: w1
    tsb.tetrate.io/trafficGroup: t1
spec:
  host: ratings.ns1.svc.cluster.local
  subsets:
  - name: stableversion
    labels:
      app: ratings
      env: prod
  - name: testversion
    labels:
      app: ratings
      env: uat
</code></pre>

<p>The namespace where the Istio APIs are applied will need to be part
of the parent traffic group. In addition, each API object will need
to have annotations to indicate the tenant, workspace and the
traffic group to which it belongs to.</p>

<p>TODO(rshriram): Document the list of fields in Istio APIs that are
disallowed.</p>

<h2 id="Group">Group</h2>
<section>
<p>A traffic group manages the routing properties of sidecars in a
group of namespaces owned by the parent workspace.</p>

<table class="message-fields">
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
<th>Required</th>
</tr>
</thead>
<tbody>
<tr id="Group-namespace_selectors">
<td><code>namespaceSelectors</code></td>
<td><code><a href="https://tetrate.io/docs/reference/config/types/v1/types.html#NamespaceSelector">NamespaceSelector[]</a></code></td>
<td>
<p>Set of namespaces owned exclusively by this group. If omitted,
applies to all resources owned by the workspace.</p>

</td>
<td>
No
</td>
</tr>
<tr id="Group-config_mode">
<td><code>configMode</code></td>
<td><code><a href="https://tetrate.io/docs/reference/config/types/v1/types.html#ConfigMode">ConfigMode</a></code></td>
<td>
<p>The Configuration types that will be added to this
group. <code>TETRATE</code> mode indicates that configurations added to this
group will use Tetrate APIs such as <code>TrafficSetting</code> and
<code>ServiceRoute</code>. <code>ISTIO</code> mode indicates that configurations added
to this group will use Istio Networking APIs such as
<code>VirtualService</code>, <code>DestinationRule</code>, and <code>Sidecar</code>. Defaults to
<code>TETRATE</code> mode.</p>

</td>
<td>
No
</td>
</tr>
</tbody>
</table>
</section>
<h2 id="tetrateio-api-tsb-types-v1-NamespaceSelector">tetrateio.api.tsb.types.v1.NamespaceSelector</h2>
<section>
<p><code>NamespaceSelector</code> selects a set of namespaces across one or more
clusters in a tenant. Namespace selectors can be used at Workspace
level to carve out a chunk of resources under a tenant into an
isolated configuration domain. They can be used in a Traffic,
Security, or a Gateway group to further scope the set of namespaces
that will belong to a specific configuration group.</p>

<table class="message-fields">
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
<th>Required</th>
</tr>
</thead>
<tbody>
<tr id="tetrateio-api-tsb-types-v1-NamespaceSelector-name">
<td><code>name</code></td>
<td><code>string</code></td>
<td>
<ul>
<li><p><code>*/ns1</code> implies <code>ns1</code> namespace in any cluster under the tenant.</p></li>

<li><p><code>c1/ns1</code> implies <code>ns1</code> namespace from <code>c1</code> cluster.</p></li>

<li><p><code>c1/*</code> implies all namespaces in <code>c1</code> cluster.</p></li>
</ul>

</td>
<td>
Yes
</td>
</tr>
</tbody>
</table>
</section>
<h2 id="TrafficSetting">TrafficSetting</h2>
<section>
<p>A traffic setting applies configuration to a set of sidecars in a
traffic group or a workspace. When applied to a traffic group,
missing fields will inherit values from the workspace-wide setting.</p>

<table class="message-fields">
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
<th>Required</th>
</tr>
</thead>
<tbody>
<tr id="TrafficSetting-reachability">
<td><code>reachability</code></td>
<td><code><a href="https://tetrate.io/docs/reference/config/traffic/v1/traffic-setting.html#ReachabilitySettings">ReachabilitySettings</a></code></td>
<td>
<p>The set of services and hosts accessed by a workload (and hence
its sidecar) in the mesh. Defining the set of services accessed
by a workload (i.e. its dependencies) in advance reduces the
memory and CPU consumption both the Istio control plane and the
individual Envoy sidecars in the data plane.</p>

</td>
<td>
No
</td>
</tr>
<tr id="TrafficSetting-egress_gateway">
<td><code>egressGateway</code></td>
<td><code>string</code></td>
<td>
<p>Specifies the details of the egress proxy to which unknown
traffic should be forwarded to from the sidecar. If not
specified, the sidecar will send the unknown traffic directly to
the IP requested by the application. Must be in
<namespace>/<fqdn> format.</p>

</td>
<td>
No
</td>
</tr>
<tr id="TrafficSetting-resilience">
<td><code>resilience</code></td>
<td><code><a href="https://tetrate.io/docs/reference/config/traffic/v1/traffic-setting.html#ResilienceSettings">ResilienceSettings</a></code></td>
<td>
<p>Resilience settings such as timeouts, retries, etc., affecting
outbound traffic from sidecars.</p>

</td>
<td>
No
</td>
</tr>
</tbody>
</table>
</section>
<h2 id="ResilienceSettings">ResilienceSettings</h2>
<section>
<p>ResilienceSettings control the reliability knobs in Envoy when making
outbound connections from a gateway or sidecar.
TODO(@rshriram): Need more examples here.</p>

<table class="message-fields">
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
<th>Required</th>
</tr>
</thead>
<tbody>
<tr id="ResilienceSettings-http_request_timeout">
<td><code>httpRequestTimeout</code></td>
<td><code><a href="https://developers.google.com/protocol-buffers/docs/reference/google.protobuf#duration">Duration</a></code></td>
<td>
<p>Timeout for HTTP requests. Disabled if not set.</p>

</td>
<td>
No
</td>
</tr>
<tr id="ResilienceSettings-http_retries">
<td><code>httpRetries</code></td>
<td><code><a href="https://tetrate.io/docs/reference/config/traffic/v1/traffic-setting.html#HTTPRetry">HTTPRetry</a></code></td>
<td>
<p>Retry policy for HTTP requests. Disabled if not set.</p>

</td>
<td>
No
</td>
</tr>
<tr id="ResilienceSettings-tcp_keepalive">
<td><code>tcpKeepalive</code></td>
<td><code><a href="https://developers.google.com/protocol-buffers/docs/reference/google.protobuf#boolvalue">BoolValue</a></code></td>
<td>
<p>If enabled, sets SO_KEEPALIVE on the socket to enable TCP Keepalives.</p>

</td>
<td>
No
</td>
</tr>
<tr id="ResilienceSettings-circuit_breaker_sensitivity">
<td><code>circuitBreakerSensitivity</code></td>
<td><code><a href="https://tetrate.io/docs/reference/config/traffic/v1/traffic-setting.html#ResilienceSettings-Sensitivity">Sensitivity</a></code></td>
<td>
<p>Circuit breakers in Envoy are applied per endpoint in a load
balancing pool. By default, circuit breakers are disabled. If
set, the sensitivity level determines the maximum number of
consecutive failures that Envoy will tolerate before ejecting an
endpoint from the load balancing pool.</p>

</td>
<td>
No
</td>
</tr>
</tbody>
</table>
</section>
<h2 id="HTTPRetry">HTTPRetry</h2>
<section>
<p>HTTPRetry defines the parameters for retrying API calls to a service.</p>

<table class="message-fields">
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
<th>Required</th>
</tr>
</thead>
<tbody>
<tr id="HTTPRetry-attempts">
<td><code>attempts</code></td>
<td><code>int32</code></td>
<td>
<p>Number of retries for a given request. The interval between retries will be determined
automatically (25ms+).</p>

<p>Actual number of retries attempted depends on the httpReqTimeout.</p>

</td>
<td>
Yes
</td>
</tr>
<tr id="HTTPRetry-per_try_timeout">
<td><code>perTryTimeout</code></td>
<td><code><a href="https://developers.google.com/protocol-buffers/docs/reference/google.protobuf#duration">Duration</a></code></td>
<td>
<p>Timeout per retry attempt for a given request. format: 1h/1m/1s/1ms. MUST BE &gt;=1ms.</p>

</td>
<td>
No
</td>
</tr>
<tr id="HTTPRetry-retry_on">
<td><code>retryOn</code></td>
<td><code>string</code></td>
<td>
<p>Specifies the conditions under which retry takes place.
One or more policies can be specified using a ‘,’ delimited list.
See the <a href="https://www.envoyproxy.io/docs/envoy/latest/configuration/http/http_filters/router_filter#x-envoy-retry-on">retry
policies</a>
and <a href="https://www.envoyproxy.io/docs/envoy/latest/configuration/http/http_filters/router_filter#x-envoy-retry-grpc-on">gRPC retry
policies</a>
for more details.</p>

</td>
<td>
No
</td>
</tr>
</tbody>
</table>
</section>
<h2 id="ReachabilitySettings">ReachabilitySettings</h2>
<section>
<p><code>ReachabilitySettings</code> define the set of services and hosts
accessed by a workload (and hence its sidecar) in the
mesh. Defining the set of services accessed by a workload (i.e. its
dependencies) in advance reduces the memory and CPU consumption
both the Istio control plane and the individual Envoy sidecars in
the data plane.</p>

<p><strong>NOTE</strong>: When used in <code>WorkspaceSetting</code>, reachability if not
specified defaults to <code>NAMESPACE</code> mode, i.e. workloads will be
able to reach only services within their namespace.</p>

<table class="message-fields">
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
<th>Required</th>
</tr>
</thead>
<tbody>
<tr id="ReachabilitySettings-mode">
<td><code>mode</code></td>
<td><code><a href="https://tetrate.io/docs/reference/config/traffic/v1/traffic-setting.html#ReachabilitySettings-Mode">Mode</a></code></td>
<td>
<p>A short cut for specifying the set of services accessed by the workload.</p>

</td>
<td>
No
</td>
</tr>
<tr id="ReachabilitySettings-hosts">
<td><code>hosts</code></td>
<td><code>string[]</code></td>
<td>
<p>When the mode is <code>CUSTOM</code>, <code>hosts</code> specify the set of services
that the sidecar should be able to reach. Must be in the
<code>&lt;namespace&gt;/&lt;fqdn&gt;</code> format.</p>

<ul>
<li><p><code>./*</code> indicates all services in the namespace where the sidecar resides.</p></li>

<li><p><code>ns1/*</code> indicates all services in the <code>ns1</code> namespace.</p></li>

<li><p><code>ns1/svc1.com</code> indicates <code>svc1.com</code> service in <code>ns1</code> namespace.</p></li>

<li><p><code>*/svc1.com</code> indicates <code>svc1.com</code> service in any namespace.</p></li>
</ul>

</td>
<td>
No
</td>
</tr>
</tbody>
</table>
</section>
<h2 id="ServiceRoute">ServiceRoute</h2>
<section>
<p>A service route controls routing configurations for traffic to a
service in a traffic group.</p>

<table class="message-fields">
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
<th>Required</th>
</tr>
</thead>
<tbody>
<tr id="ServiceRoute-service">
<td><code>service</code></td>
<td><code>string</code></td>
<td>
<p>The service on which the configuration is being applied. Must be in namespace/FQDN format.</p>

</td>
<td>
Yes
</td>
</tr>
<tr id="ServiceRoute-subsets">
<td><code>subsets</code></td>
<td><code><a href="https://tetrate.io/docs/reference/config/traffic/v1/service-route.html#ServiceRoute-Subset">Subset[]</a></code></td>
<td>
<p>The set of versions of a service and the percentage of traffic to
send to each version.</p>

</td>
<td>
No
</td>
</tr>
</tbody>
</table>
</section>
<h2 id="ServiceRoute-Subset">ServiceRoute.Subset</h2>
<section>
<p>Subset denotes a specific version of a service. The pods/VMs of a
subset should be uniquely identifiable using their labels.</p>

<table class="message-fields">
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
<th>Required</th>
</tr>
</thead>
<tbody>
<tr id="ServiceRoute-Subset-name">
<td><code>name</code></td>
<td><code>string</code></td>
<td>
<p>Name used to refer to the subset.</p>

</td>
<td>
Yes
</td>
</tr>
<tr id="ServiceRoute-Subset-labels">
<td><code>labels</code></td>
<td><code>map&lt;string,&nbsp;string&gt;</code></td>
<td>
<p>Labels apply a filter over the endpoints of a service in the service registry.</p>

</td>
<td>
Yes
</td>
</tr>
<tr id="ServiceRoute-Subset-weight">
<td><code>weight</code></td>
<td><code>uint32</code></td>
<td>
<p>Percentage of traffic to be sent to this subset. The sum of
weights across all subsets should add up to 100.</p>

</td>
<td>
Yes
</td>
</tr>
</tbody>
</table>
</section>
<h2 id="tetrateio-api-tsb-types-v1-ConfigMode">tetrateio.api.tsb.types.v1.ConfigMode</h2>
<section>
<p>The configuration mode used by a traffic, security or a gateway group.</p>

<table class="enum-values">
<thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr id="tetrateio-api-tsb-types-v1-ConfigMode-TETRATE">
<td><code>TETRATE</code></td>
<td>
<p>Indicates that the configurations to be added to the group will use Tetrate APIs.</p>

</td>
</tr>
<tr id="tetrateio-api-tsb-types-v1-ConfigMode-ISTIO">
<td><code>ISTIO</code></td>
<td>
<p>Indicates that the configurations to be added to the group will use Istio APIs.</p>

</td>
</tr>
</tbody>
</table>
</section>
<h2 id="tetrateio-api-tsb-types-v1-ConfigMode">tetrateio.api.tsb.types.v1.ConfigMode</h2>
<section>
<p>The configuration mode used by a traffic, security or a gateway group.</p>

<table class="enum-values">
<thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr id="tetrateio-api-tsb-types-v1-ConfigMode-TETRATE">
<td><code>TETRATE</code></td>
<td>
<p>Indicates that the configurations to be added to the group will use Tetrate APIs.</p>

</td>
</tr>
<tr id="tetrateio-api-tsb-types-v1-ConfigMode-ISTIO">
<td><code>ISTIO</code></td>
<td>
<p>Indicates that the configurations to be added to the group will use Istio APIs.</p>

</td>
</tr>
</tbody>
</table>
</section>
<h2 id="ResilienceSettings-Sensitivity">ResilienceSettings.Sensitivity</h2>
<section>
<p>Available sensitivity levels for the circuit breaker.</p>

<table class="enum-values">
<thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr id="ResilienceSettings-Sensitivity-UNSET">
<td><code>UNSET</code></td>
<td>
</td>
</tr>
<tr id="ResilienceSettings-Sensitivity-LOW">
<td><code>LOW</code></td>
<td>
<p>Tolerate upto 20 consecutive 5xx or connection failures from an
endpoint before ejecting it temporarily from the load balancing
pool.</p>

</td>
</tr>
<tr id="ResilienceSettings-Sensitivity-MEDIUM">
<td><code>MEDIUM</code></td>
<td>
<p>Tolerate upto 10 consecutive 5xx or connection failures from an
endpoint before ejecting it temporarily from the load balancing
pool.</p>

</td>
</tr>
<tr id="ResilienceSettings-Sensitivity-HIGH">
<td><code>HIGH</code></td>
<td>
<p>Tolerate upto 5 consecutive 5xx or connection failures from an
endpoint before ejecting it temporarily from the load balancing
pool.</p>

</td>
</tr>
</tbody>
</table>
</section>
<h2 id="ReachabilitySettings-Mode">ReachabilitySettings.Mode</h2>
<section>
<p>A short cut for defining the common reachability patterns</p>

<table class="enum-values">
<thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr id="ReachabilitySettings-Mode-UNSET">
<td><code>UNSET</code></td>
<td>
<p>Inherit from parent if possible. Otherwise treated as NAMESPACE.</p>

</td>
</tr>
<tr id="ReachabilitySettings-Mode-NAMESPACE">
<td><code>NAMESPACE</code></td>
<td>
<p>The workload may talk to any service in its own namespace.</p>

</td>
</tr>
<tr id="ReachabilitySettings-Mode-GROUP">
<td><code>GROUP</code></td>
<td>
<p>The workload may talk to any service in the traffic group.</p>

</td>
</tr>
<tr id="ReachabilitySettings-Mode-WORKSPACE">
<td><code>WORKSPACE</code></td>
<td>
<p>The workload may talk to any service in the workspace.</p>

</td>
</tr>
<tr id="ReachabilitySettings-Mode-CLUSTER">
<td><code>CLUSTER</code></td>
<td>
<p>The workload may talk to any service in the cluster.</p>

</td>
</tr>
<tr id="ReachabilitySettings-Mode-CUSTOM">
<td><code>CUSTOM</code></td>
<td>
<p>The workload may talk to services defined explicitly.</p>

</td>
</tr>
</tbody>
</table>
</section>
