{
  "swagger": "2.0",
  "info": {
    "title": "TCC Workflows API",
    "version": "v1",
    "contact": {
      "name": "Tetrate.io, Inc.",
      "url": "https://www.tetrate.io",
      "email": "info@tetrate.io"
    }
  },
  "host": "localhost:8000",
  "schemes": [
    "http"
  ],
  "consumes": [
    "application/json"
  ],
  "produces": [
    "application/json"
  ],
  "paths": {
    "/v1/tenants/{tenant}/workflows/clusters/{cluster}/loadbalancer/attach": {
      "post": {
        "operationId": "Attach",
        "responses": {
          "200": {
            "description": "A successful response.",
            "schema": {
              "$ref": "#/definitions/tetrate.api.tcc.workflows.v1.LBTicketId"
            }
          },
          "404": {
            "description": "Returned when the resource does not exist.",
            "schema": {
              "format": "string"
            }
          }
        },
        "parameters": [
          {
            "name": "tenant",
            "in": "path",
            "required": true,
            "type": "string"
          },
          {
            "name": "cluster",
            "in": "path",
            "required": true,
            "type": "string"
          },
          {
            "name": "body",
            "in": "body",
            "required": true,
            "schema": {
              "$ref": "#/definitions/tetrate.api.tcc.workflows.v1.LBTicketDetails"
            }
          }
        ],
        "tags": [
          "LoadBalancerWorkflow"
        ]
      }
    },
    "/v1/tenants/{tenant}/workflows/clusters/{cluster}/loadbalancer/detach": {
      "post": {
        "operationId": "Detach",
        "responses": {
          "200": {
            "description": "A successful response.",
            "schema": {
              "$ref": "#/definitions/tetrate.api.tcc.workflows.v1.LBTicketId"
            }
          },
          "404": {
            "description": "Returned when the resource does not exist.",
            "schema": {
              "format": "string"
            }
          }
        },
        "parameters": [
          {
            "name": "tenant",
            "in": "path",
            "required": true,
            "type": "string"
          },
          {
            "name": "cluster",
            "in": "path",
            "required": true,
            "type": "string"
          },
          {
            "name": "body",
            "in": "body",
            "required": true,
            "schema": {
              "$ref": "#/definitions/tetrate.api.tcc.workflows.v1.LBTicketDetails"
            }
          }
        ],
        "tags": [
          "LoadBalancerWorkflow"
        ]
      }
    },
    "/v1/tenants/{tenant}/workflows/clusters/{cluster}/loadbalancer/pending": {
      "get": {
        "operationId": "ListPendingTickets",
        "responses": {
          "200": {
            "description": "A successful response.",
            "schema": {
              "$ref": "#/definitions/tetrate.api.tcc.workflows.v1.ListTicketsResponse"
            }
          },
          "404": {
            "description": "Returned when the resource does not exist.",
            "schema": {
              "format": "string"
            }
          }
        },
        "parameters": [
          {
            "name": "tenant",
            "in": "path",
            "required": true,
            "type": "string"
          },
          {
            "name": "cluster",
            "in": "path",
            "required": true,
            "type": "string"
          }
        ],
        "tags": [
          "LoadBalancerWorkflow"
        ]
      }
    },
    "/v1/tenants/{tenant}/workflows/clusters/{cluster}/loadbalancer/publish": {
      "post": {
        "summary": "LB owner calls this API with additional settings like TLS, to\nfinally expose the service on the load balancer",
        "operationId": "Publish",
        "responses": {
          "200": {
            "description": "A successful response.",
            "schema": {
              "$ref": "#/definitions/tetrate.api.tcc.workflows.v1.LBTicketStatus"
            }
          },
          "404": {
            "description": "Returned when the resource does not exist.",
            "schema": {
              "format": "string"
            }
          }
        },
        "parameters": [
          {
            "name": "tenant",
            "in": "path",
            "required": true,
            "type": "string"
          },
          {
            "name": "cluster",
            "in": "path",
            "required": true,
            "type": "string"
          },
          {
            "name": "body",
            "in": "body",
            "required": true,
            "schema": {
              "$ref": "#/definitions/tetrate.api.tcc.workflows.v1.LBPublishAction"
            }
          }
        ],
        "tags": [
          "LoadBalancerWorkflow"
        ]
      }
    },
    "/v1/tenants/{tenant}/workflows/clusters/{cluster}/loadbalancer/request/{requestid}/approve": {
      "post": {
        "operationId": "Approve",
        "responses": {
          "200": {
            "description": "A successful response.",
            "schema": {
              "$ref": "#/definitions/tetrate.api.tcc.workflows.v1.LBTicketStatus"
            }
          },
          "404": {
            "description": "Returned when the resource does not exist.",
            "schema": {
              "format": "string"
            }
          }
        },
        "parameters": [
          {
            "name": "tenant",
            "in": "path",
            "required": true,
            "type": "string"
          },
          {
            "name": "cluster",
            "in": "path",
            "required": true,
            "type": "string"
          },
          {
            "name": "requestid",
            "in": "path",
            "required": true,
            "type": "string"
          },
          {
            "name": "body",
            "in": "body",
            "required": true,
            "schema": {
              "$ref": "#/definitions/tetrate.api.tcc.workflows.v1.LBTicketResolution"
            }
          }
        ],
        "tags": [
          "LoadBalancerWorkflow"
        ]
      }
    },
    "/v1/tenants/{tenant}/workflows/clusters/{cluster}/loadbalancer/request/{requestid}/cancel": {
      "post": {
        "operationId": "Cancel",
        "responses": {
          "200": {
            "description": "A successful response.",
            "schema": {
              "$ref": "#/definitions/tetrate.api.tcc.workflows.v1.LBTicketStatus"
            }
          },
          "404": {
            "description": "Returned when the resource does not exist.",
            "schema": {
              "format": "string"
            }
          }
        },
        "parameters": [
          {
            "name": "tenant",
            "in": "path",
            "required": true,
            "type": "string"
          },
          {
            "name": "cluster",
            "in": "path",
            "required": true,
            "type": "string"
          },
          {
            "name": "requestid",
            "in": "path",
            "required": true,
            "type": "string"
          },
          {
            "name": "body",
            "in": "body",
            "required": true,
            "schema": {
              "$ref": "#/definitions/tetrate.api.tcc.workflows.v1.LBTicketId"
            }
          }
        ],
        "tags": [
          "LoadBalancerWorkflow"
        ]
      }
    },
    "/v1/tenants/{tenant}/workflows/clusters/{cluster}/loadbalancer/request/{requestid}/deny": {
      "post": {
        "operationId": "Deny",
        "responses": {
          "200": {
            "description": "A successful response.",
            "schema": {
              "$ref": "#/definitions/tetrate.api.tcc.workflows.v1.LBTicketStatus"
            }
          },
          "404": {
            "description": "Returned when the resource does not exist.",
            "schema": {
              "format": "string"
            }
          }
        },
        "parameters": [
          {
            "name": "tenant",
            "in": "path",
            "required": true,
            "type": "string"
          },
          {
            "name": "cluster",
            "in": "path",
            "required": true,
            "type": "string"
          },
          {
            "name": "requestid",
            "in": "path",
            "required": true,
            "type": "string"
          },
          {
            "name": "body",
            "in": "body",
            "required": true,
            "schema": {
              "$ref": "#/definitions/tetrate.api.tcc.workflows.v1.LBTicketResolution"
            }
          }
        ],
        "tags": [
          "LoadBalancerWorkflow"
        ]
      }
    },
    "/v1/tenants/{tenant}/workflows/clusters/{cluster}/loadbalancer/request/{requestid}/status": {
      "get": {
        "operationId": "GetTicketStatus",
        "responses": {
          "200": {
            "description": "A successful response.",
            "schema": {
              "$ref": "#/definitions/tetrate.api.tcc.workflows.v1.LBTicketStatus"
            }
          },
          "404": {
            "description": "Returned when the resource does not exist.",
            "schema": {
              "format": "string"
            }
          }
        },
        "parameters": [
          {
            "name": "tenant",
            "in": "path",
            "required": true,
            "type": "string"
          },
          {
            "name": "cluster",
            "in": "path",
            "required": true,
            "type": "string"
          },
          {
            "name": "requestid",
            "in": "path",
            "required": true,
            "type": "string"
          }
        ],
        "tags": [
          "LoadBalancerWorkflow"
        ]
      }
    }
  },
  "definitions": {
    "tetrate.api.tcc.workflows.v1.LBPublishAction": {
      "type": "object",
      "properties": {
        "loadbalancerName": {
          "type": "string"
        },
        "loadbalancerNamespace": {
          "type": "string"
        },
        "serviceName": {
          "type": "string"
        },
        "serviceNamespace": {
          "type": "string"
        },
        "cluster": {
          "type": "string"
        },
        "tenant": {
          "type": "string"
        },
        "tls": {
          "$ref": "#/definitions/tetrate.api.tcc.workflows.v1.TLSSettings"
        }
      }
    },
    "tetrate.api.tcc.workflows.v1.LBTicketDetails": {
      "type": "object",
      "properties": {
        "loadbalancerName": {
          "type": "string"
        },
        "loadbalancerNamespace": {
          "type": "string"
        },
        "serviceHostname": {
          "type": "string"
        },
        "serviceNamespace": {
          "type": "string"
        },
        "cluster": {
          "type": "string"
        },
        "tenant": {
          "type": "string"
        }
      }
    },
    "tetrate.api.tcc.workflows.v1.LBTicketId": {
      "type": "object",
      "properties": {
        "requestid": {
          "type": "string"
        },
        "cluster": {
          "type": "string"
        },
        "tenant": {
          "type": "string"
        }
      }
    },
    "tetrate.api.tcc.workflows.v1.LBTicketResolution": {
      "type": "object",
      "properties": {
        "tenant": {
          "type": "string"
        },
        "cluster": {
          "type": "string"
        },
        "requestid": {
          "type": "string"
        },
        "note": {
          "type": "string",
          "title": "optional description (e.g. to be recorded in audit logs)"
        }
      }
    },
    "tetrate.api.tcc.workflows.v1.LBTicketStatus": {
      "type": "object",
      "properties": {
        "tenant": {
          "type": "string"
        },
        "cluster": {
          "type": "string"
        },
        "requestid": {
          "type": "string",
          "title": "e.g. attach-789"
        },
        "note": {
          "type": "string"
        }
      }
    },
    "tetrate.api.tcc.workflows.v1.ListTicketsResponse": {
      "type": "object",
      "properties": {
        "cluster": {
          "type": "string"
        },
        "pendingTickets": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/tetrate.api.tcc.workflows.v1.ListTicketsResponse.PendingTickets"
          }
        }
      }
    },
    "tetrate.api.tcc.workflows.v1.ListTicketsResponse.PendingTickets": {
      "type": "object",
      "properties": {
        "loadbalancerName": {
          "type": "string"
        },
        "loadbalancerNamespace": {
          "type": "string"
        },
        "serviceHostname": {
          "type": "string"
        },
        "serviceNamespace": {
          "type": "string"
        },
        "operation": {
          "$ref": "#/definitions/tetrate.api.tcc.workflows.v1.ListTicketsResponse.PendingTickets.OP"
        }
      }
    },
    "tetrate.api.tcc.workflows.v1.ListTicketsResponse.PendingTickets.OP": {
      "type": "string",
      "enum": [
        "ATTACH",
        "DETACH"
      ],
      "default": "ATTACH"
    },
    "tetrate.api.tcc.workflows.v1.TLSSettings": {
      "type": "object",
      "properties": {
        "sni": {
          "type": "string",
          "description": "If specified, only allow requests that match the SNI value."
        },
        "serverCertificate": {
          "type": "string",
          "description": "For proxies running on VMs, the path to the file holding the\nserver-side TLS certificate to use."
        },
        "privateKey": {
          "type": "string",
          "description": "For proxies running on VMs, the path to the file holding the\nserver's private key."
        },
        "caCertificates": {
          "type": "string",
          "description": "For proxies running on VMs, the path to a file containing\ncertificate authority certificates to use in verifying a\npresented client side certificate for mutual TLS connections."
        },
        "secretName": {
          "type": "string",
          "description": "For proxies running on Kubernetes, the name of the secret that\nholds the TLS certs. Currently applicable only on Kubernetes.\nThe secret should contain the server certificate and the private\nkey. If mutual TLS is being used, an additional secret with name\nsecretName-cacert should be created with the CaCertificates that\nthe server will use to verify client side certificates. If the\nservice is exposed via a load balancer, the secret must be\naccessible to it."
        }
      }
    }
  }
}
